const tempJewellery: JeweleryProduct[] = [
  {
    id: 1,
    productName: "ring 1",
    type: "ring",
    price: 500,
    sellerName: "sssssssssssssssssssss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "18K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 2,
    productName: "bracelet",
    type: "bracelet",
    price: 500,
    sellerName: "sss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "24K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 2,
    productName: "bracelet",
    type: "bracelet",
    price: 500,
    sellerName: "sss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "24K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 2,
    productName: "bracelet",
    type: "bracelet",
    price: 500,
    sellerName: "sss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "24K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 2,
    productName: "bracelet",
    type: "bracelet",
    price: 500,
    sellerName: "sss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "24K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 2,
    productName: "bracelet",
    type: "bracelet",
    price: 500,
    sellerName: "sss",
    sellerId: 22222,
    area: "aaa",
    goldDegree: "24K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 3,
    productName: "011",
    type: "ring",
    price: 500,
    area: "aaa",
    sellerName: 'bbb',
    sellerId: 33333,
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 4,
    productName: "ring",
    type: "ring",
    price: 500,
    sellerName: "bbb",
    sellerId: 33333,
    area: "aaa",
    goldDegree: "21K",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 5,
    productName: "ring",
    type: "ring",
    price: 600,
    sellerName: "aaa",
    sellerId: 11111,
    goldDegree: "21K",
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  },
  {
    id: 6,
    productName: "earring",
    type: "earring",
    goldDegree: "21K",
    price: 200,
    sellerName: "aaa",
    sellerId: 22222,
    area: "aaa",
    imageUrl: [{
      name: '01.png',
      url: "/app/images/01.png"
    }],
    publishDate: "5/5/2017"
  }
];

const productTypes: string[] = [
  'ring',
  'bracelet',
  'earring',
  'necklace',
  'other'
];

const goldDegree: string[] = [
  '18K',
  '16K',
  '21K',
  '24K'
];

import {Injectable} from "@angular/core";
import {Subject} from "rxjs/Subject";
import {SearchForm, JeweleryProduct} from "../index";
@Injectable()

export class JewelleryService {
  private searchTerms = new Subject<SearchForm>();
  searchTermsChanged = this.searchTerms.asObservable();

  getMostVisitedJewellery() {
    return tempJewellery;
  }

  getHotDeals() {
    return tempJewellery;
  }

  getJewelleryById(id: number): JeweleryProduct {
    let choosedJewellery: JeweleryProduct;
    tempJewellery.map((item) => {
      item.id === id ? choosedJewellery = item : true;
    });
    return choosedJewellery;
  }

  getJewelleryByType(type: string): JeweleryProduct[] {
    return tempJewellery.filter((item) => {
      return item.type === type;
    })
  }

  setSearchTerms(newSearchTerms: SearchForm) {
    this.searchTerms.next(newSearchTerms);
  }

  getJewelleryBySellerId(id: number): JeweleryProduct[] {
    return tempJewellery.filter((item) => {
      return item.sellerId === id;
    })
  }

  private applySearchTerms(searchTerms: SearchForm, ...searchTerm: SearchForm[]): JeweleryProduct[] {
    let searchResult: JeweleryProduct[] = [];
    console.log(searchTerm)
    if (searchTerm.length === 1) {
      tempJewellery.map((item) => {
        if (item["" + searchTerm[0]].includes(searchTerms["" + searchTerm[0]])) {
          searchResult.push(item);
        }
      });
    }
    else if (searchTerm.length === 2) {
      tempJewellery.map((item) => {
        if (item["" + searchTerm[0]].includes(searchTerms["" + searchTerm[0]]) && item["" + searchTerm[1]].includes(searchTerms["" + searchTerm[1]])) {
          searchResult.push(item);
        }
      });
    }
    else if (searchTerm.length === 3) {
      tempJewellery.map((item) => {
        if (item["" + searchTerm[0]].includes(searchTerms["" + searchTerm[0]]) && item["" + searchTerm[1]].includes(searchTerms["" + searchTerm[1]]) && item["" + searchTerm[2]].includes(searchTerms["" + searchTerm[2]])) {
          searchResult.push(item);
        }
      });
    }

    return searchResult;
  }

  searchJewellery(searchTerms: SearchForm): JeweleryProduct[] {
    console.log(searchTerms)
    let searchTermTitles = [];
    for (let property in searchTerms) {
      if (searchTerms.hasOwnProperty(property)) {
        searchTermTitles.push(property);
      }
    }
    return this.applySearchTerms(searchTerms, ...searchTermTitles);
  }

  getProductTypes() {
    return productTypes;
  }

  getGoldDegree() {
    return goldDegree;
  }

  /*currently simulate back-end but later will integrate a real back-end*/
  deleteProduct(product: JeweleryProduct) {
    tempJewellery.splice(tempJewellery.indexOf(product), 1);
    return true;
  }

  /*this function for prototype purpose*/
  addProductLocally(product: JeweleryProduct) {
    tempJewellery.map((x, i) => {
      if (x.id == product.id) {
        tempJewellery[i] = product;
      }
    });
    if (!~tempJewellery.indexOf(product)) {
      tempJewellery.push(product);
    }
    console.log(tempJewellery);
  }

  applyFilterTerms(terms: any, fullProductsList: JeweleryProduct[]) {
    console.log(terms);
    if (terms.type !== 'All' || terms.goldDegree !== 'All') {
      return (fullProductsList.filter((product) => {
        if (terms.type !== 'All' && terms.goldDegree !== 'All') {
          return product.type == terms.type && product.goldDegree == terms.goldDegree;
        } else if (terms.type == 'All' || terms.goldDegree == 'All') {
          return product.type == terms.type || product.goldDegree == terms.goldDegree;
        }
      }))
    } else {
      return fullProductsList.slice();
    }
  }

  sortProducts(sortTerm: string, productsList: JeweleryProduct[]) {
    productsList.sort((a, b) => {
      if (sortTerm == 'Highest first') {
        return b.price - a.price;
      } else if (sortTerm == 'Lowest first') {
        return a.price - b.price;
      }
    })
  }

}




